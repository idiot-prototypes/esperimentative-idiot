/*
 * Copyright (c) 2022 GaÃ«l PORTAY
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef ZEPHYR_DRIVERS_SENSOR_BH1750_H_
#define ZEPHYR_DRIVERS_SENSOR_BH1750_H_

#include <zephyr/types.h>
#include <zephyr/device.h>
#include <zephyr/devicetree.h>
#include <zephyr/drivers/spi.h>
#include <zephyr/drivers/i2c.h>

#define DT_DRV_COMPAT rohm_bh1750

#define BH1750_BUS_I2C DT_ANY_INST_ON_BUS_STATUS_OKAY(i2c)

#define BH1750_POWER_DOWN                           0x00
#define BH1750_POWER_ON                             0x01
#define BH1750_RESET                                0x07
#define BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE    0x10
#define BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE_2  0x11
#define BH1750_CONTINUOUSLY_LOW_RESOLUTION_MODE     0x13
#define BH1750_ONE_TIME_HIGH_RESOLUTION_MODE        0x20
#define BH1750_ONE_TIME_HIGH_RESOLUTION_MODE_2      0x21
#define BH1750_ONE_TIME_LOW_RESOLUTION_MODE         0x23
#define BH1750_CHANGE_MEASUREMENT_TIME_HIGH_7_5_BIT 0x40
#define BH1750_CHANGE_MEASUREMENT_TIME_LOW_4_0_BIT  0x60

#if defined CONFIG_BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE
#define BH1750_MEASUREMENT_MODE BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE
#define BH1750_MEASUREMENT_TIME_MS_MAX 120
#elif defined CONFIG_BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE_2
#define BH1750_MEASUREMENT_MODE BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE_2
#define BH1750_MEASUREMENT_TIME_MS_MAX 120
#elif defined CONFIG_BH1750_CONTINUOUSLY_LOW_RESOLUTION_MODE
#define BH1750_MEASUREMENT_MODE BH1750_CONTINUOUSLY_LOW_RESOLUTION_MODE
#define BH1750_MEASUREMENT_TIME_MS_MAX 24
#elif defined CONFIG_BH1750_ONE_TIME_HIGH_RESOLUTION_MODE
#define BH1750_MEASUREMENT_MODE BH1750_ONE_TIME_HIGH_RESOLUTION_MODE
#define BH1750_MEASUREMENT_TIME_MS_MAX 120
#elif defined CONFIG_BH1750_ONE_TIME_HIGH_RESOLUTION_MODE_2
#define BH1750_MEASUREMENT_MODE BH1750_ONE_TIME_HIGH_RESOLUTION_MODE_2
#define BH1750_MEASUREMENT_TIME_MS_MAX 120
#elif defined CONFIG_BH1750_ONE_TIME_LOW_RESOLUTION_MODE
#define BH1750_MEASUREMENT_MODE BH1750_ONE_TIME_LOW_RESOLUTION_MODE
#define BH1750_MEASUREMENT_TIME_MS_MAX 24
#else
/* FIXME: assuming continuously high resolution mode */
#define BH1750_MEASUREMENT_MODE BH1750_CONTINUOUSLY_HIGH_RESOLUTION_MODE
#define BH1750_MEASUREMENT_TIME_MS_MAX 180
#endif

#define BH1750_CHANGE_MEASUREMENT_TIME_HIGH(val) (0x40 | ((val & 0xE0) >> 5))
#define BH1750_CHANGE_MEASUREMENT_TIME_LOW(val)  (0x60 | ((val & 0x1F) >> 0))

#endif /* ZEPHYR_DRIVERS_SENSOR_BH1750_H_ */
